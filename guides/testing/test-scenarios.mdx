---
title: "Test Scenarios"
description: "End-to-end test scenarios, error simulation, payment method matrices, and comprehensive checklists for Yuno sandbox testing"
---

## Overview

Thorough testing prevents production issues by validating every payment path before going live. This guide provides test matrices by country, 3DS flow validation, error simulation techniques, and end-to-end checklists for your Yuno sandbox integration.

## Payment Method Test Matrix by Country

### Brazil (BR / BRL)

| Payment Method | Test Identifier | Expected Status | Notes |
|---------------|----------------|-----------------|-------|
| CARD (Visa) | `4111 1111 1111 1111` | `SUCCEEDED` | Standard card flow |
| CARD (Mastercard) | `5500 0000 0000 0004` | `SUCCEEDED` | Standard card flow |
| CARD (Declined) | `4000 0000 0000 0002` | `DECLINED` | Insufficient funds |
| PIX | CPF: `12345678901` | `PENDING` | Returns QR code; auto-completes in ~30s |
| Boleto | CPF: `12345678901` | `PENDING` | Returns boleto URL; simulate payment in Dashboard |

### Mexico (MX / MXN)

| Payment Method | Test Identifier | Expected Status | Notes |
|---------------|----------------|-----------------|-------|
| CARD (Visa) | `4111 1111 1111 1111` | `SUCCEEDED` | Standard card flow |
| CARD (Declined) | `4000 0000 0000 0010` | `DECLINED` | Do not honor |
| OXXO | Email required | `PENDING` | Returns voucher reference; simulate in Dashboard |

### Colombia (CO / COP)

| Payment Method | Test Identifier | Expected Status | Notes |
|---------------|----------------|-----------------|-------|
| CARD (Visa) | `4111 1111 1111 1111` | `SUCCEEDED` | Standard card flow |
| CARD (3DS) | `4000 0000 0000 3220` | `PENDING` | 3DS challenge, then `SUCCEEDED` |
| BANK_TRANSFER | CC: `1234567890` | `PENDING` | Returns redirect URL to simulated bank |
| PSE | CC: `1234567890` | `PENDING` | Bank selection + redirect flow |

### Chile (CL / CLP)

| Payment Method | Test Identifier | Expected Status | Notes |
|---------------|----------------|-----------------|-------|
| CARD (Visa) | `4111 1111 1111 1111` | `SUCCEEDED` | Standard card flow |
| BANK_TRANSFER | RUT: `111111111` | `PENDING` | Redirect to simulated bank |

### Argentina (AR / ARS)

| Payment Method | Test Identifier | Expected Status | Notes |
|---------------|----------------|-----------------|-------|
| CARD (Visa) | `4111 1111 1111 1111` | `SUCCEEDED` | Standard card flow |
| BANK_TRANSFER | DNI: `12345678` | `PENDING` | Redirect flow |

---

## 3DS Test Flows

### Frictionless Flow (No Customer Interaction)

Use card `4000 0000 0000 0085` or `4000 0000 0000 3063`:

<CodeGroup>
```javascript Node.js
const response = await fetch('https://api-sandbox.y.uno/v1/payments', {
  method: 'POST',
  headers: {
    'public-api-key': process.env.YUNO_PUBLIC_KEY,
    'private-secret-key': process.env.YUNO_PRIVATE_KEY,
    'account-code': process.env.YUNO_ACCOUNT_CODE,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    checkout_session: sessionId,
    payment_method: { type: 'CARD', token: 'frictionless-token' },
    amount: { currency: 'USD', value: 50.00 },
    country: 'CO',
    customer: { email: 'customer@example.com' },
  }),
});

const payment = await response.json();

// Frictionless: payment completes immediately
if (payment.status === 'SUCCEEDED') {
  console.log('Frictionless 3DS: Payment approved');
  console.log('3DS status:', payment.payment_method?.three_d_secure?.status);
  // Expected: "AUTHENTICATED"
}
```

```python Python
response = requests.post(
    'https://api-sandbox.y.uno/v1/payments',
    headers=headers,
    json={
        'checkout_session': session_id,
        'payment_method': {'type': 'CARD', 'token': 'frictionless-token'},
        'amount': {'currency': 'USD', 'value': 50.00},
        'country': 'CO',
        'customer': {'email': 'customer@example.com'},
    },
)
payment = response.json()

# Frictionless: payment completes immediately
if payment['status'] == 'SUCCEEDED':
    print('Frictionless 3DS: Payment approved')
```
</CodeGroup>

### Challenge Flow (Customer Interaction Required)

Use card `4000 0000 0000 3220` or `4000 0000 0000 0101`:

<CodeGroup>
```javascript Node.js
const payment = await createPayment(/* ... with 3DS challenge card */);

if (payment.status === 'PENDING' && payment.redirect_url) {
  // Step 1: Redirect customer to 3DS challenge page
  console.log('Redirect customer to:', payment.redirect_url);

  // Step 2: Customer completes challenge on issuer page
  // (In sandbox, a simulated challenge page appears)

  // Step 3: Customer is redirected back to your callback_url
  // with the payment result

  // Step 4: Verify final status via webhook or API
  const finalPayment = await fetch(
    `https://api-sandbox.y.uno/v1/payments/${payment.id}`,
    { headers }
  ).then(r => r.json());

  console.log('Final status:', finalPayment.status);
  // Expected: "SUCCEEDED" (if challenge completed)
  // or "DECLINED" (if challenge failed/abandoned)
}
```

```python Python
payment = create_payment(# ... with 3DS challenge card)

if payment['status'] == 'PENDING' and payment.get('redirect_url'):
    # Step 1: Redirect customer to 3DS challenge
    print(f"Redirect to: {payment['redirect_url']}")

    # Step 2: Customer completes challenge (simulated in sandbox)
    # Step 3: Customer redirected back to callback_url
    # Step 4: Verify final status
    final = requests.get(
        f"https://api-sandbox.y.uno/v1/payments/{payment['id']}",
        headers=headers,
    ).json()
    print(f"Final status: {final['status']}")
```
</CodeGroup>

### 3DS Test Matrix

| Card | Flow | Expected Result |
|------|------|-----------------|
| `4000 0000 0000 0085` | Frictionless | `SUCCEEDED` with `AUTHENTICATED` |
| `4000 0000 0000 3063` | Frictionless | `SUCCEEDED` with `AUTHENTICATED` |
| `4000 0000 0000 0093` | Frictionless | `DECLINED` (auth denied) |
| `4000 0000 0000 3220` | Challenge | `PENDING` -> redirect -> `SUCCEEDED` |
| `4000 0000 0000 0101` | Challenge | `PENDING` -> redirect -> `SUCCEEDED` |
| `4000 0000 0000 0119` | Challenge | `PENDING` -> redirect -> `DECLINED` |
| `4000 0000 0000 3097` | Challenge | `PENDING` -> redirect -> `DECLINED` |

---

## Two-Step Payment Flows (Authorize + Capture)

Test the full authorization and capture lifecycle:

### Authorize

```bash
# Create an authorized payment (not yet captured)
curl -X POST https://api-sandbox.y.uno/v1/payments \
  -H "public-api-key: $YUNO_PUBLIC_KEY" \
  -H "private-secret-key: $YUNO_PRIVATE_KEY" \
  -H "account-code: $YUNO_ACCOUNT_CODE" \
  -H "Content-Type: application/json" \
  -d '{
    "checkout_session": "session-id",
    "payment_method": {"type": "CARD", "token": "test-token"},
    "amount": {"currency": "USD", "value": 100.00},
    "country": "CO",
    "capture": false
  }'
# Expected status: "AUTHORIZED"
```

### Capture

```bash
# Capture the full amount
curl -X POST https://api-sandbox.y.uno/v1/payments/{payment_id}/capture \
  -H "public-api-key: $YUNO_PUBLIC_KEY" \
  -H "private-secret-key: $YUNO_PRIVATE_KEY" \
  -H "account-code: $YUNO_ACCOUNT_CODE" \
  -H "Content-Type: application/json"
# Expected status: "SUCCEEDED"
```

### Cancel (Void)

```bash
# Cancel an authorized payment (release hold on customer's card)
curl -X POST https://api-sandbox.y.uno/v1/payments/{payment_id}/cancel \
  -H "public-api-key: $YUNO_PUBLIC_KEY" \
  -H "private-secret-key: $YUNO_PRIVATE_KEY" \
  -H "account-code: $YUNO_ACCOUNT_CODE" \
  -H "Content-Type: application/json"
# Expected status: "CANCELLED"
```

---

## Error Simulation

### HTTP Error Codes

Simulate API-level errors by using specific values in your test requests:

| Scenario | How to Trigger | Expected Response |
|----------|---------------|-------------------|
| Missing required field | Omit `customer.document` for PIX | `400` `INVALID_FIELD` |
| Invalid currency | Use `currency: "XXX"` | `400` `INVALID_CURRENCY` |
| Invalid country-method combo | PIX with `country: "MX"` | `400` `PAYMENT_METHOD_NOT_AVAILABLE` |
| Invalid authentication | Use wrong `private-secret-key` | `401` `UNAUTHORIZED` |
| Method not enabled | Use a method not enabled in Dashboard | `403` `FORBIDDEN` |
| Resource not found | Use invalid payment ID | `404` `NOT_FOUND` |
| Rate limit exceeded | Send >100 requests/minute | `429` `RATE_LIMITED` |

### Provider-Level Errors

Provider declines are simulated using specific [test card numbers](/guides/testing/test-cards):

| Type | Cards | Behavior |
|------|-------|----------|
| **Soft decline** (retriable) | `4000000000000002`, `5500000000000012` | Insufficient funds, generic decline |
| **Hard decline** (do not retry) | `4000000000000010`, `4000000000000028`, `4000000000000036`, `4000000000000044` | Do not honor, invalid card, expired, stolen |
| **Gateway error** | `4000000000000069` | Provider returns 500 |
| **Timeout** | `4000000000000051` | 30-second delay, then timeout error |

### Timeout Simulation

To test your timeout handling:

1. Use card `4000 0000 0000 0051` (processing timeout)
2. Your request will hang for ~30 seconds, then return a timeout error
3. Verify your client handles the timeout gracefully
4. Check that your webhook handler processes the async status update

---

## Refund Testing

### Full Refund

```bash
curl -X POST https://api-sandbox.y.uno/v1/payments/{payment_id}/refund \
  -H "public-api-key: $YUNO_PUBLIC_KEY" \
  -H "private-secret-key: $YUNO_PRIVATE_KEY" \
  -H "account-code: $YUNO_ACCOUNT_CODE" \
  -H "Content-Type: application/json" \
  -d '{"reason": "Customer request"}'
# Expected: payment.refunded webhook
```

### Partial Refund

```bash
curl -X POST https://api-sandbox.y.uno/v1/payments/{payment_id}/refund \
  -H "public-api-key: $YUNO_PUBLIC_KEY" \
  -H "private-secret-key: $YUNO_PRIVATE_KEY" \
  -H "account-code: $YUNO_ACCOUNT_CODE" \
  -H "Content-Type: application/json" \
  -d '{"amount": {"value": 25.00, "currency": "USD"}, "reason": "Partial return"}'
# Expected: payment.partially_refunded webhook
```

---

## End-to-End Test Checklists

### Payment Creation

- [ ] Successful card payment (Visa `4111111111111111`)
- [ ] Successful card payment (Mastercard `5500000000000004`)
- [ ] Declined card payment (insufficient funds `4000000000000002`)
- [ ] Hard declined card payment (invalid card `4000000000000028`)
- [ ] PIX payment with QR code generation (BR, auto-completes in ~30s)
- [ ] OXXO voucher generation (MX, simulate in Dashboard)
- [ ] Bank transfer redirect flow (CO)
- [ ] Missing required fields return clear `400` error messages
- [ ] Invalid authentication returns `401`

### 3DS Flows

- [ ] Frictionless 3DS succeeds without redirect (`4000000000000085`)
- [ ] Challenge flow redirects correctly (`4000000000003220`)
- [ ] Customer completes challenge successfully (`4000000000000101`)
- [ ] Customer abandons challenge, payment fails (`4000000000000119`)
- [ ] Callback URL receives correct parameters after redirect

### Two-Step Flows (Authorize + Capture)

- [ ] Authorization creates payment with `AUTHORIZED` status
- [ ] Full capture transitions to `SUCCEEDED`
- [ ] Cancel (void) releases authorized funds (`CANCELLED`)
- [ ] Expired authorization handled gracefully

### Refunds

- [ ] Full refund on succeeded payment
- [ ] Partial refund with correct remaining amount
- [ ] Multiple partial refunds up to original amount
- [ ] Refund on uncaptured payment returns error

### Webhooks

- [ ] Webhook signature verification passes for valid events
- [ ] Invalid signatures rejected with `401`
- [ ] Duplicate events handled idempotently (same event ID)
- [ ] All subscribed event types received and processed
- [ ] Handler responds within 15 seconds

### Error Handling

- [ ] Network timeouts handled with retry logic
- [ ] Rate limiting (`429`) triggers exponential backoff
- [ ] Provider errors (gateway error card) surface meaningful messages
- [ ] Invalid payloads return descriptive validation errors

### SDK Integration (if applicable)

- [ ] SDK initializes with correct checkout session
- [ ] Payment form renders all enabled payment methods
- [ ] Card tokenization produces valid one-time token
- [ ] SDK callbacks fire for success, error, and cancel
- [ ] SDK version matches server-side API version requirements
